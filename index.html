<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å - –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    const SUPABASE_URL = 'https://stiqjgpqfqmcpnmdqmhi.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN0aXFqZ3BxZnFtY3BubWRxbWhpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2NjcwOTQsImV4cCI6MjA3MzI0MzA5NH0.fR8LOlrEVQmeYwW383TTrODr9RXm77bwtC7aYtOOWBw';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  </script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="style/style.css">
  <script defer src="js/script.js"></script>
  <script defer src="js/modal.js"></script>
  <script defer src="js/burger.js"></script>
  <script defer src="js/dropdown-menu.js"></script>
  <script defer src="js/slider.js"></script>
  <script defer src="pages/data.js"></script>
  <script defer src="js/aside.js"></script>
  <script defer src="js/service_main.js"></script>
</head>

<body class="font-sans ">


  <header class="bg-gray-100 sticky top-0 z-50 shadow-md">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <div class="flex items-center">

        <a href="./" class="ml-2 text-xl font-semibold flex items-center hover:text-blue-600 transition">
          <span class="mr-2">(–õ–æ–≥–æ)</span>
          <span>–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏</span>
        </a>
      </div>


      <nav id="mobileMenu" class="hidden fixed top-16 right-0 w-64 bg-white shadow-md py-4 px-6 space-y-4">
        <a href="#" class="block text-gray-700 hover:text-blue-600">–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</a>
        <a href="#" class="block text-gray-700 hover:text-blue-600">–£—Å–ª—É–≥–∏</a>
        <a href="#" class="block text-gray-700 hover:text-blue-600">–ö–æ–º–ø–∞–Ω–∏—è</a>
        <a href="#" class="block text-gray-700 hover:text-blue-600">–ü–æ–¥–¥–µ—Ä–∂–∫–∞</a>
        <a href="tel:+71231232827" class="block text-gray-700 hover:text-blue-600">+7 (123)¬†123‚Äë28‚Äë27</a>
      </nav>


      <div class="flex items-center space-x-4">
        <button id="openModalBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition">
          –ó–∞–∫–∞–∑–∞—Ç—å –∑–≤–æ–Ω–æ–∫
        </button>
        <div class="hidden md:block">
          <a href="tel:+71231232827" class="text-gray-700 hover:text-blue-600">+7 (123) 123‚Äì28‚Äì27</a>
        </div>
        <button id="burger" class="text-gray-700 hamburger-menu flex flex-col gap-1 p-2 cursor-pointer">
          <span class="block w-5 h-0.5 bg-gray-700 transition-all duration-300"></span>
          <span class="block w-5 h-0.5 bg-gray-700 transition-all duration-300"></span>
          <span class="block w-5 h-0.5 bg-gray-700 transition-all duration-300"></span>
        </button>
      </div>
    </div>
  </header>


  <section class="relative pb-20 lg:pb-0">

    <style>
      .map-img {
        opacity: 0;
        transition: opacity .2s ease
      }

      .map-img.loaded {
        opacity: 1
      }

.map-box { overflow: hidden; }
.map-box .map-img{
  transition: transform .35s cubic-bezier(.2,.7,.2,1), opacity .2s ease;
  transform-origin: center center;
  will-change: transform, opacity;
}
/* —Ä–∞–Ω—å—à–µ 1.2 ‚Äî –ø–æ–¥–Ω–∏–º–µ–º –¥–æ 1.38 */
.place-card:hover .map-box .map-img { transform: scale(1.25); }

@media (prefers-reduced-motion: reduce){
  .map-box .map-img{ transition: none; }
  .place-card:hover .map-box .map-img{ transform: none; }
}

    </style>

    <section id="mapCards" class="gap-4 mb-6 bg-white">
      <div class="container mx-auto px-4">
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mt-4">

          <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ 1 -->
          <div
            class="place-card relative bg-white border rounded-lg shadow hover:shadow-md transition overflow-hidden flex flex-col cursor-pointer focus:outline-none focus:ring-2 focus:ring-indigo-500"
            data-id="1" tabindex="0">
            <div class="p-3 border-b">
              <h3 class="text-base font-semibold text-gray-900 line-clamp-2 min-h-[48px]">
                –ö–∞–ª–∏–Ω–∏–Ω—Å–∫–∏–π <br> –ë–ª—é—Ö–µ—Ä–∞
              </h3>
            </div>
            <div class="relative aspect-[4/3] map-box">
              <div class="map-skeleton absolute inset-0 bg-gray-200 animate-pulse"></div>
              <img class="map-img absolute inset-0 w-full h-full object-cover opacity-0 transition-opacity duration-300"
                alt="–ö–∞—Ä—Ç–∞" loading="lazy" />
            </div>

            <div class="p-3">
              <div class="text-sm text-gray-600">–°—Ç—Ä–∏—Ç —Ä–∏—Ç–µ–π–ª</div>
            </div>
          </div>




          <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ 2 -->


          <div class="bg-white border rounded-lg shadow hover:shadow-md transition overflow-hidden flex flex-col">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
            <div class="p-3 border-b">
              <h3 class="text-base font-semibold text-gray-900 line-clamp-2 min-h-[48px]">–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–π</h3>
            </div>

            <!-- –ö–∞—Ä—Ç–∞ -->
            <div class="relative aspect-[4/3] map-box">
              <img src="https://static-maps.yandex.ru/1.x/?ll=30.35,59.95&z=15&size=300,200&l=map&pt=30.35,59.95,pm2rdm"
                alt="–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–π" class="absolute inset-0 w-full h-full object-cover" />
            </div>

            <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
            <div class="p-3">
              <div class="text-sm text-gray-600">–û—Ñ–∏—Å—ã, —Å–µ—Ä–≤–∏—Å—ã, —Å–∫–ª–∞–¥—ã</div>
            </div>
          </div>

          <div class="bg-white border rounded-lg shadow hover:shadow-md transition overflow-hidden flex flex-col">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
            <div class="p-3 border-b">
              <h3 class="text-base font-semibold text-gray-900 line-clamp-2 min-h-[48px]">–ë–µ—Å—Ç—É–∂–µ–≤—Å–∫–∞—è</h3>
            </div>

            <!-- –ö–∞—Ä—Ç–∞ -->
            <div class="relative aspect-[4/3] map-box">
              <img src="https://static-maps.yandex.ru/1.x/?ll=30.35,59.95&z=15&size=300,200&l=map&pt=30.35,59.95,pm2rdm"
                alt="–ë–µ—Å—Ç—É–∂–µ–≤—Å–∫–∞—è" class="absolute inset-0 w-full h-full object-cover" />
            </div>

            <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
            <div class="p-3">
              <div class="text-sm text-gray-600">–°–∫–ª–∞–¥—ã, –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</div>
            </div>
          </div>

          <div class="bg-white border rounded-lg shadow hover:shadow-md transition overflow-hidden flex flex-col">
            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
            <div class="p-3 border-b">
              <h3 class="text-base font-semibold text-gray-900 line-clamp-2 min-h-[48px]">–ë–æ–≥–æ—Å–ª–æ–≤—Å–∫–∞—è</h3>
            </div>

            <!-- –ö–∞—Ä—Ç–∞ -->
            <div class="relative aspect-[4/3] map-box">
              <img src="https://static-maps.yandex.ru/1.x/?ll=30.39,59.96&z=14&size=300,200&l=map&pt=30.39,59.96,pm2rdm"
                alt="–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–π" class="absolute inset-0 w-full h-full object-cover" />
            </div>

            <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
            <div class="p-3">
              <div class="text-sm text-gray-600">–û—Ñ–∏—Å—ã, —Å–µ—Ä–≤–∏—Å—ã, —Å–∫–ª–∞–¥—ã</div>
            </div>
          </div>

        </div>
      </div>





    </section>

    <!--   
  <img
    src="https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?w=1200&h=400&fit=crop"
    alt="–ì–µ—Ä–æ–π"
    class="w-full h-64 md:h-80 lg:h-[420px] object-cover" /> -->


    <div class="
  relative
  inset-x-0 mx-auto
  w-full md:w-3/4 lg:w-2/3
  bg-white shadow-sm rounded-lg  
  px-8 py-6
  min-h-24 md:min-h-28
  flex flex-wrap justify-center items-center gap-6
  z-10
  mt-6 lg:mt-10
">
      <div class="inline-flex"></div>

      <div class="relative inline-block flex-[1_1_12rem]  min-w-[11rem]  max-w-[22rem]" data-filter-key="place">
        <button class="filter-toggle w-full flex items-center justify-between gap-2 text-lg
         px-4 py-4 bg-gray-100 text-gray-700
         hover:bg-indigo-600 hover:text-white transition
         border border-gray-300 rounded-none" data-placeholder="–ü–ª–æ—â–∞–¥–∫–∞">
          <span class="filter-label truncate">–ü–ª–æ—â–∞–¥–∫–∞</span>
          <i class="fas fa-chevron-down flex-shrink-0"></i>
        </button>
        <ul class="filter-options hidden absolute left-0 right-0 mt-2
         min-w-full max-w-[min(28rem,90vw)]
         bg-white rounded-lg shadow-lg py-2 z-30">
          <li><a href="#" data-value="–ö—É—à–µ–ª–µ–≤—Å–∫–∞—è –¥–æ—Ä–æ–≥–∞"
              class="block px-4 py-2 hover:bg-indigo-600 hover:text-white">–ö—É—à–µ–ª–µ–≤—Å–∫–∞—è –¥–æ—Ä–æ–≥–∞</a></li>
          <li><a href="#" data-value="–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–π –ø—Ä–æ—Å–ø–µ–∫—Ç"
              class="block px-4 py-2 hover:bg-indigo-600 hover:text-white">–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–π –ø—Ä–æ—Å–ø–µ–∫—Ç</a></li>
          <li><a href="#" data-value="–ë–µ—Å—Ç—É–∂–µ–≤—Å–∫–∞—è"
              class="block px-4 py-2 hover:bg-indigo-600 hover:text-white">–ë–µ—Å—Ç—É–∂–µ–≤—Å–∫–∞—è</a></li>
          <li><a href="#" data-value="–ê–û ¬´–°–µ—Å—Ç—Ä–æ—Ä–µ—Ü–∫–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –∑–∞–≤–æ–¥¬ª"
              class="block px-4 py-2 leading-snug whitespace-normal hover:bg-indigo-600 hover:text-white">–ê–û
              ¬´–°–µ—Å—Ç—Ä–æ—Ä–µ—Ü–∫–∏–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π –∑–∞–≤–æ–¥¬ª</a></li>
        </ul>
      </div>


      <div class="relative inline-block flex-[1_1_12rem]  min-w-[11rem]  max-w-[22rem]" data-filter-key="purpose">
        <button class="filter-toggle w-full h-16 flex items-center justify-between gap-2 text-lg
         px-4 bg-gray-100 text-gray-700
         hover:bg-indigo-600 hover:text-white transition
         border border-gray-300 rounded-none" data-placeholder="–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ">
          <span class="filter-label truncate">–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ</span>
          <i class="fas fa-chevron-down flex-shrink-0"></i>
        </button>
        <ul class="filter-options hidden
           absolute left-0 right-0  
           mt-2 bg-white rounded-lg shadow-lg py-2 z-30">
          <li><a href="#" data-value="office" class="block px-4 py-2 hover:bg-indigo-600 hover:text-white">–û—Ñ–∏—Å–Ω—ã–µ
              –ø–æ–º–µ—â–µ–Ω–∏—è</a></li>
          <li><a href="#" data-value="production"
              class="block px-4 py-2 hover:bg-indigo-600 hover:text-white">–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ</a></li>
          <li><a href="#" data-value="warehouse"
              class="block px-4 py-2 hover:bg-indigo-600 hover:text-white">–°–∫–ª–∞–¥—Å–∫–∏–µ</a></li>
          <li><a href="#" data-value="retail" class="block px-4 py-2 hover:bg-indigo-600 hover:text-white">–¢–æ—Ä–≥–æ–≤—ã–µ
              –ø–ª–æ—â–∞–¥–∏</a></li>
          <li><a href="#" data-value="land" class="block px-4 py-2 hover:bg-indigo-600 hover:text-white">–ó–µ–º–µ–ª—å–Ω—ã–µ
              —É—á–∞—Å—Ç–∫–∏</a></li>
        </ul>
      </div>


      <div class="relative inline-block flex-[1_1_12rem]  min-w-[11rem]  max-w-[22rem]" data-filter-key="minArea">
        <button class="filter-toggle w-full h-16 flex justify-between items-center text-lg
         px-6 bg-gray-100 text-gray-700 hover:bg-indigo-600 hover:text-white transition
         border border-gray-300 rounded-none" data-placeholder="–ü–ª–æ—â–∞–¥—å –æ—Ç">
          <span class="filter-label">–ü–ª–æ—â–∞–¥—å –æ—Ç</span>
          <i class="fas fa-chevron-down flex-shrink-0"></i>
        </button>

        <ul class="filter-options hidden absolute left-0 right-0 mt-2 text-lg
           min-w-full max-w-[min(28rem,90vw)]
           bg-white rounded-lg shadow-lg py-2 z-30">
          <li><a href="#" data-value="0" class="block px-4 py-2 hover:bg-indigo-600 hover:text-white">0 –º¬≤</a></li>
          <li><a href="#" data-value="50" class="block px-4 py-2 hover:bg-indigo-600 hover:text-white">50 –º¬≤</a></li>
          <li><a href="#" data-value="100" class="block px-4 py-2 hover:bg-indigo-600 hover:text-white">100 –º¬≤</a></li>
          <li><a href="#" data-value="200" class="block px-4 py-2 hover:bg-indigo-600 hover:text-white">200 –º¬≤</a></li>
        </ul>
      </div>



      <div class="relative inline-block flex-[1_1_12rem]  min-w-[11rem]  max-w-[22rem] text-lg"
        data-filter-key="maxArea">

        <button class="filter-toggle flex items-center justify-between
         w-full h-16 px-6
         bg-gray-100 text-gray-700 hover:bg-indigo-600 hover:text-white transition
         border border-gray-300 rounded-none" data-placeholder="–ü–ª–æ—â–∞–¥—å –¥–æ">
          <span class="filter-label">–ü–ª–æ—â–∞–¥—å –¥–æ</span>
          <i class="fas fa-chevron-down flex-shrink-0"></i>
        </button>


        <ul class="filter-options hidden absolute left-0 right-0 mt-2
           min-w-full max-w-[min(28rem,90vw)]
           bg-white rounded-lg shadow-lg py-2 z-30 text-lg">
          <li><a href="#" data-value="100" class="block px-4 py-2 hover:bg-indigo-600 hover:text-white">100 –º¬≤</a></li>
          <li><a href="#" data-value="200" class="block px-4 py-2 hover:bg-indigo-600 hover:text-white">200 –º¬≤</a></li>
          <li><a href="#" data-value="500" class="block px-4 py-2 hover:bg-indigo-600 hover:text-white">500 –º¬≤</a></li>
          <li><a href="#" data-value="1000" class="block px-4 py-2 hover:bg-indigo-600 hover:text-white">1 000 –º¬≤</a>
          </li>
        </ul>
      </div>




      <div class="w-full basis-full flex flex-col md:flex-row items-stretch md:items-center justify-center gap-3 mt-4">
        <button class="show-results bg-indigo-600 hover:bg-indigo-700 text-white 
           h-14 md:h-20 px-6 md:px-8 rounded-md 
           w-full md:w-auto">
          –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
        </button>
        <!-- <a href="#mapSection"
       class="flex items-center gap-1 h-10 px-6 rounded-md border border-indigo-600
              text-indigo-600 hover:bg-indigo-50 transition"> <i class="fas fa-map-marker-alt"></i>
      –°–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ
    </a> -->
        <!-- –ú–∏–Ω–∏-–∫–∞—Ä—Ç–∞ (–∫–Ω–æ–ø–∫–∞) -->
        <div id="mapThumbBtn" class="relative group cursor-pointer select-none w-full md:w-auto">
          <div class="relative h-14 md:h-20 w-full md:w-[28rem] min-w-0 
                rounded-md border border-indigo-600 shadow-sm overflow-hidden">
            <div id="mapThumbCanvas" class="absolute inset-0"></div>
            <div class="absolute inset-0 bg-black/20"></div>
          </div>

          <!-- –ü–û–ü–û–í–ï–† -->
          <div class="pointer-events-none absolute z-50 opacity-0 group-hover:opacity-100 transition
                -top-2 left-1/2 -translate-x-1/2 -translate-y-full hidden md:block">
            <div class="rounded-xl shadow-2xl ring-1 ring-black/10 overflow-hidden">
              <div class="relative w-[480px] h-[300px] bg-white">
                <div id="mapThumbPreview" class="absolute inset-0"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <button id="openMapBtn" class="hidden"></button>


  </section>


  <section class="pt-8 bg-white">
    <div class="mx-auto w-full md:w-3/4 lg:w-2/3 px-4">
      <h2 class="text-3xl font-bold text-center mb-2 text-gray-800">

        <!-- –ë–∏–∑–Ω–µ—Å—ã -->
      </h2>


      <div class="grid grid-cols-1 lg:grid-cols-1 gap-6 items-start">

        <div class="rounded-xl shadow-sm p-6 bg-gray-50 border border-gray-200 space-y-5">

          <!-- –®–∞–≥ 1 -->
          <div class="space-y-2 mb-3">
            <h3 class="text-lg font-semibold">–°–µ–≥–º–µ–Ω—Ç</h3>
            <div id="bizSuperCats" class="flex flex-wrap items-center gap-2"></div>
          </div>

          <!-- –®–∞–≥ 1 -->
          <div id="bizTopWrap" class="hidden">
            <h3 class="text-lg font-semibold">–°–µ–≥–º–µ–Ω—Ç 2</h3>
            <div id="bizTopCats" class="flex flex-wrap items-center gap-2"></div>
          </div>

          <!-- –®–∞–≥ 2 -->
          <div id="bizSubcatsWrap" class="hidden mt-4">
            <h3 class="text-lg font-semibold mb-3">–ß—Ç–æ –∏–º–µ–Ω–Ω–æ –≤—ã –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç–µ?</h3>
            <div id="bizSubcats" class="flex flex-wrap gap-2"></div>
          </div>

          <!-- –®–∞–≥ 3 -->
          <h3 class="text-xl font-semibold mb-4 hidden" data-results-title>–ü–æ–¥—Ö–æ–¥—è—â–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã</h3>
          <div id="bizResultsWrap" class="hidden">
            <div class="mt-8 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6" id="matchingCards">
            </div>
          </div>

          <!-- –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) -->
          <div id="bizEmpty" class="hidden  text-gray-600 rounded-lg px-4 py-8 text-center">

          </div>

        </div>


      </div>
    </div>


    <!-- –ë–ª–æ–∫ –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ -->
    <div id="matchingCardsAll" class="mt-8 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
      <!-- –∫–∞—Ä—Ç–æ—á–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —Å—é–¥–∞  -->
    </div>
    </div>
  </section>



  <section class="bg-gray-50 pt-[20px] py-8">
    <div class="container mx-auto px-4 grid grid-cols-1 lg:grid-cols-3 gap-6">



      <div id="sitesBlock" class="bg-white rounded-lg shadow p-6 lg:col-span-2">
        <h3 class="text-xl font-semibold mb-4">–ü–ª–æ—â–∞–¥–∫–∏</h3>
        <div id="siteList" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
      </div>


      <div class="bg-white rounded-lg shadow p-4 lg:col-span-1">
        <h3 class="text-xl font-semibold mb-4">–†–µ–∫–ª–∞–º–∞</h3>

        <div id="adSlider" class="relative overflow-hidden h-72">
          <div id="adSlides" class="flex transition-transform duration-500 ease-linear h-full w-full">

          </div>
          <button id="adPrev"
            class="absolute left-2 top-1/2 -translate-y-1/2 p-2 rounded-full shadow bg-white bg-opacity-80 hover:bg-opacity-100 transition-all lg:flex hidden">
            <i class="fas fa-chevron-left"></i>
          </button>
          <button id="adNext"
            class="absolute right-2 top-1/2 -translate-y-1/2 p-2 rounded-full shadow bg-white bg-opacity-80 hover:bg-opacity-100 transition-all lg:flex hidden">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>
  </section>










  <section id="services" class="py-16 bg-white">
    <div class="container mx-auto px-4">
      <h2 class="text-3xl font-bold text-center mb-12 text-gray-800">–£—Å–ª—É–≥–∏</h2>

      <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ -->
      <div id="serviceCards" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6">
        <!-- —Å—é–¥–∞ JS –≤—Å—Ç–∞–≤–∏—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ -->
      </div>

      <!-- –ë–ª–æ–∫ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º -->
      <div id="serviceDetail" class="mt-12 grid md:grid-cols-2 gap-6 items-stretch hidden">
        <!-- –§–æ—Ç–æ -->
        <div class="relative aspect-[4/3] md:aspect-[16/9]">
          <img id="serviceImage" class="absolute inset-0 w-full h-full object-cover rounded-lg shadow" />
        </div>
        <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
        <div class="bg-gray-50 rounded-lg p-6 flex flex-col">
          <h3 id="serviceTitle" class="text-2xl font-semibold mb-3"></h3>
          <p id="serviceDesc" class="text-gray-700 mb-6"></p>
          <!-- –ö–Ω–æ–ø–∫–∞ -->
          <div class="mt-auto">
            <a id="serviceCta" href="#"
              class="inline-flex items-center gap-2 px-5 py-3 rounded-md bg-indigo-600 text-white hover:bg-indigo-700 transition">
              –û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É <i class="fa-solid fa-arrow-right-long"></i>
            </a>
          </div>

          <!-- –ú–∏–Ω–∏-—Ñ–æ—Ä–º–∞ (–º–æ–¥–∞–ª–∫–∞) -->
          <div id="serviceFormModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
            <div class="bg-white rounded-lg shadow-lg p-6 w-[90%] max-w-md relative">
              <!-- –ó–∞–∫—Ä—ã—Ç—å -->
              <button id="closeServiceForm" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800 text-xl">
                &times;
              </button>

              <h3 class="text-xl font-semibold mb-4">–û—Å—Ç–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É</h3>

              <form id="serviceForm" class="space-y-4">
                <!-- –£—Å–ª—É–≥–∞ -->
                <div>
                  <label class="block text-sm text-gray-600 mb-1">–£—Å–ª—É–≥–∞</label>
                  <input id="serviceFormTitle" type="text" readonly
                    class="w-full border px-3 py-2 rounded-md bg-gray-50" />
                  <input id="serviceFormSlug" type="hidden" name="service" />
                </div>

                <!-- –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ -->
                <p id="serviceFormHint" class="text-sm text-gray-500"></p>



                <div>
                  <input name="name" type="text" placeholder="–í–∞—à–µ –∏–º—è"
                    class="w-full border px-3 py-2 rounded-md focus:ring focus:ring-indigo-300" required>
                </div>
                <div>
                  <input name="phone" type="tel" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω"
                    class="w-full border px-3 py-2 rounded-md focus:ring focus:ring-indigo-300" required>
                </div>

                <!-- –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å -->
                <div>
                  <label class="block text-sm text-gray-600 mb-1">–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å</label>
                  <textarea name="task" id="serviceTask" rows="3"
                    class="w-full border px-3 py-2 rounded-md focus:ring focus:ring-indigo-300"
                    placeholder="–û–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É..."></textarea>
                </div>

                <button type="submit"
                  class="w-full bg-indigo-600 text-white py-2 rounded-md hover:bg-indigo-700 transition">
                  –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                </button>
              </form>

            </div>
          </div>


          <script>
const BASE = (() => {
  const seg = location.pathname.split('/').filter(Boolean)[0] || '';
  return location.hostname.endsWith('github.io') && seg ? '/' + seg : '';
})();
function buildDetailUrl(purpose, id) {
  const url = new URL(BASE + '/pages/detail.html', location.origin);
  url.searchParams.set('purpose', purpose);
  url.searchParams.set('id', id);
  return url.toString();
}
function buildListUrl(place) {
  const url = new URL(BASE + '/pages/list.html', location.origin);
  if (place) url.searchParams.set('place', place);
  const f = window.filters || {};
  if (f.minArea != null) url.searchParams.set('minArea', f.minArea);
  if (f.maxArea != null) url.searchParams.set('maxArea', f.maxArea);
  return url.toString();
}

            document.addEventListener("DOMContentLoaded", () => {
              const ctaBtn = document.getElementById("serviceCta");
              const modal = document.getElementById("serviceFormModal");
              const closeBtn = document.getElementById("closeServiceForm");

              const inputTitle = document.getElementById("serviceFormTitle");
              const inputSlug = document.getElementById("serviceFormSlug");
              const form = document.getElementById("serviceForm");

              // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏
              ctaBtn.addEventListener("click", (e) => {
                e.preventDefault();

                // –ë–µ—Ä—ë–º –¥–∞–Ω–Ω—ã–µ –∏–∑ data-* (–æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–±)
                const slug = ctaBtn.dataset.serviceSlug || "";
                const title = ctaBtn.dataset.serviceTitle || document.getElementById("serviceTitle")?.textContent || "";

                inputTitle.value = title;
                inputSlug.value = slug;

                modal.classList.remove("hidden");
                modal.classList.add("flex");
              });

              // –ó–∞–∫—Ä—ã—Ç–∏–µ
              function closeModal() {
                modal.classList.add("hidden");
                modal.classList.remove("flex");
              }
              closeBtn.addEventListener("click", closeModal);
              modal.addEventListener("click", (e) => { if (e.target === modal) closeModal(); });
              document.addEventListener("keydown", (e) => { if (e.key === "Escape") closeModal(); });

              // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã (–¥–µ–º–æ)
              form.addEventListener("submit", (e) => {
                e.preventDefault();
                const data = Object.fromEntries(new FormData(form).entries());
                // data = { service: 'it', name: '...', phone: '...' }
                console.log("–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—è–≤–∫–∏:", { ...data, serviceTitle: inputTitle.value });

                // –∑–¥–µ—Å—å –≤–º–µ—Å—Ç–æ console.log –æ—Ç–ø—Ä–∞–≤–ª—è–π fetch(...) –Ω–∞ —Å–≤–æ–π –±—ç–∫–µ–Ω–¥

                closeModal();
                alert("–°–ø–∞—Å–∏–±–æ! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏.");
              });
            });
          </script>


        </div>
      </div>
    </div>
  </section>

  <script>
    let SERVICES = [];
    let servicesLoaded = false;

    async function loadServices() {
      const { data, error } = await supabase
        .from('services')
        .select('slug, title, desc, form_hint, img, icon, sort, is_active')
        .eq('is_active', true)
        .order('sort', { ascending: true });

      if (error) {
        console.error('Supabase error:', error);
        return [];
      }
      return (data || []).map(r => ({
        slug: r.slug,
        title: r.title,
        desc: r.desc,
        formHint: r.form_hint,
        img: r.img,
        icon: r.icon
      }));
    }

    function renderCards() {
      const container = document.getElementById("serviceCards");
      container.innerHTML = "";
      SERVICES.forEach((s) => {
        const card = document.createElement("div");
        card.className =
          "bg-gray-50 hover:bg-gray-100 p-6 rounded-lg transition text-center cursor-pointer";
        card.dataset.slug = s.slug;
        card.innerHTML = `
      <div class="text-blue-600 text-4xl mb-4"><i class="fas ${s.icon}"></i></div>
      <h3 class="text-xl font-semibold mb-2">${s.title}</h3>
      <p class="text-gray-600">${s.desc}</p>
    `;
        card.addEventListener("click", () => selectService(s.slug, { updateUrl: true }));
        container.appendChild(card);
      });
    }

    function renderDetail(svc) {
      document.getElementById("serviceImage").src = svc.img;
      document.getElementById("serviceImage").alt = svc.title;
      document.getElementById("serviceTitle").textContent = svc.title;
      document.getElementById("serviceDesc").textContent = svc.desc;
      document.getElementById("serviceCta").href = "#request";
      document.getElementById("serviceDetail").classList.remove("hidden");
    }

    function selectService(slug, { updateUrl } = { updateUrl: false }) {
      const svc = SERVICES.find((s) => s.slug === slug) || SERVICES[0];
      if (!svc) return;

      renderDetail(svc);

      const cta = document.getElementById("serviceCta");
      if (cta) {
        cta.dataset.serviceSlug = svc.slug;
        cta.dataset.serviceTitle = svc.title;
      }

      document.querySelectorAll("#serviceCards > div").forEach((el) => {
        el.classList.remove("ring-2", "ring-indigo-600", "bg-white", "shadow-lg");
      });
      const activeCard = document.querySelector(`#serviceCards > div[data-slug="${svc.slug}"]`);
      activeCard?.classList.add("ring-2", "ring-indigo-600", "bg-white", "shadow-lg");

      if (updateUrl) {
        const url = new URL(window.location.href);
        url.searchParams.set("service", svc.slug);
        history.pushState({ service: svc.slug }, "", url);
      }
    }

    async function initServices() {

      document.getElementById("serviceCards").innerHTML =
        '<div class="col-span-full text-center text-gray-500">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>';

      SERVICES = await loadServices();
      servicesLoaded = true;

      renderCards();

      const param = new URL(window.location.href).searchParams.get("service");
      selectService(param || (SERVICES[0]?.slug), { updateUrl: !param });
    }

    window.addEventListener("popstate", () => {
      const param = new URL(window.location.href).searchParams.get("service");
      if (servicesLoaded) selectService(param || (SERVICES[0]?.slug));
    });

    document.addEventListener("DOMContentLoaded", initServices);
  </script>




  <section id="mapSection" class="pt-16 bg-white">
    <!-- <h2 class="text-3xl font-bold text-center mb-12 text-gray-800">
            –ù–∞—à–∏ –æ–±—ä–µ–∫—Ç—ã –Ω–∞ –∫–∞—Ä—Ç–µ
        </h2>
        <div class="w-full overflow-hidden">
            <div id="map" class="w-full h-[500px]"></div>
        </div> -->

    <script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU" type="text/javascript"></script>

    <script>
      ymaps.ready(function () {
        // –≥–∞—Ä–∞–Ω—Ç–∏—è –Ω–∞–ª–∏—á–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏–∑ —Ç–≤–æ–µ–≥–æ script.js
        window.filters = window.filters || { place: null, purpose: null, minArea: null, maxArea: null };

        const openBtn = document.getElementById('openMapBtn');
        const modal = document.getElementById('mapModal');
        const overlay = modal?.querySelector('.modal-overlay');
        const closeBtn = document.getElementById('closeMapBtn');
        const mapEl = document.getElementById('modalMap');

        let map = null;
        const groups = new Map();  // coordKey -> { coords, items:[], placemark }

        // –°–æ–±–µ—Ä—ë–º –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã (–¥–æ–±–∞–≤–∏–º —Å–ª—É–∂–µ–±–Ω–æ–µ _purpose)
        const allItems = Object.entries(window.dataByPurpose || {})
          .flatMap(([purpose, arr]) => (arr || []).map(it => ({ ...it, _purpose: purpose })))
          .filter(it => Array.isArray(it.coordinates) && it.coordinates.length === 2);

        // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º (–æ–¥–Ω–∞ –º–µ—Ç–∫–∞ ‚Äî –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç–æ–≤)
        allItems.forEach(it => {
          const key = it.coordinates.join(',');
          if (!groups.has(key)) groups.set(key, { coords: it.coordinates.map(Number), items: [], placemark: null });
          groups.get(key).items.push(it);
        });

        function createBalloonContent(itemsAtPoint) {
          const first = itemsAtPoint[0];
          const place = first.place;
          const desc = (window.placeDescriptions && window.placeDescriptions[place]) || '–û–ø–∏—Å–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.';
          const total = itemsAtPoint.reduce((s, o) => s + Number(o.area || 0), 0);

          if (itemsAtPoint.length === 1) {
            const d = itemsAtPoint[0];
            const detailUrl = buildDetailUrl(d._purpose, d.id);
            return `
        <div style="padding:15px;font-family:Arial,sans-serif;">
          <h3 style="margin:0 0 10px;color:#333;">${d.name}</h3>
          <p style="margin-bottom:8px;">${desc}</p>
          <p><strong>–ü–ª–æ—â–∞–¥—å:</strong> ${d.area} –º¬≤</p>
          <div style="margin-top:15px;">
            <a href="${detailUrl}" style="color:#007bff;text-decoration:none;font-weight:bold;">–ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Üí</a>
          </div>
        </div>`;
          }

          const listUrl = buildListUrl(place);
          return `
      <div style="padding:15px;font-family:Arial,sans-serif;">
        <h3 style="margin:0 0 10px;color:#333;">${place}</h3>
        <p style="margin-bottom:8px;">${desc}</p>
        <p><strong>–û–±—ä–µ–∫—Ç–æ–≤:</strong> ${itemsAtPoint.length}</p>
        <p><strong>–°—É–º–º–∞—Ä–Ω–∞—è –ø–ª–æ—â–∞–¥—å:</strong> ${total} –º¬≤</p>
        <div style="margin-top:15px;">
          <a href="${listUrl}" style="color:#007bff;text-decoration:none;font-weight:bold;">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –æ–±—ä–µ–∫—Ç—ã ‚Üí</a>
        </div>
      </div>`;
        }

        // –µ–¥–∏–Ω—ã–π layout –¥–ª—è —ç–º–æ–¥–∑–∏ üìç (–Ω–∏–∫–∞–∫–∏—Ö preset'–æ–≤)
        const EmojiPinLayout = ymaps.templateLayoutFactory.createClass(
          '<div style="position:absolute; transform:translate(-50%,-100%);' +
          'font-size:40px; line-height:1; user-select:none;">üìç</div>'
        );

        // —Å–æ–∑–¥–∞—ë—Ç –ø–ª–µ–π—Å–º–∞—Ä–∫ —Å —ç–º–æ–¥–∑–∏
        function makeEmojiPlacemark(coords, props = {}) {
          return new ymaps.Placemark(
            Array.isArray(coords) ? coords.map(Number) : coords,
            props,
            {
              iconLayout: EmojiPinLayout, // <- —Å–≤–æ–π layout
              // —è–∫–æ—Ä—å –ø—Ä–∏–º–µ—Ä–Ω–æ –∫–∞–∫ —É –æ–±—ã—á–Ω–æ–π –º–µ—Ç–∫–∏
              iconShape: { type: 'Circle', coordinates: [0, -30], radius: 10 },
              zIndex: 500,
              zIndexHover: 600
            }
          );
        }

        function ensureMap() {
          if (map || !mapEl) return;

          map = new ymaps.Map(
            mapEl,
            { center: [59.93, 30.33], zoom: 11, controls: ['zoomControl'] },
            { suppressMapOpenBlock: true }
          );

          // –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π —É–±–∏—Ä–∞–µ–º –≤—Å—ë, —á—Ç–æ –º–æ–≥–ª–æ –æ—Å—Ç–∞—Ç—å—Å—è
          map.geoObjects.removeAll();

          groups.forEach(group => {
            const placeName = (group.items?.[0]?.place || '').trim();
            const pm = makeEmojiPlacemark(group.coords, {
              placeName,
              hintContent: placeName ? `üìç ${placeName}` : undefined,
              balloonContent: createBalloonContent(group.items)
            });
            group.placemark = pm;
            map.geoObjects.add(pm);
          });

          // —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –æ—Ö–≤–∞—Ç
          const pts = [];
          groups.forEach(g => pts.push(g.coords));
          if (pts.length === 1) {
            map.setCenter(pts[0], 14);
          } else if (pts.length > 1) {
            const b = ymaps.util.bounds.fromPoints(pts);
            map.setBounds(b, { checkZoomRange: true, zoomMargin: 30 });
          }
        }



        function matchesFilters(group) {
          const f = window.filters || {};
          const items = group.items;

          // place
          if (f.place && group.placemark.properties.get('placeName') !== f.place) return false;

          // purpose
          if (f.purpose) {
            const anyPurpose = items.some(it => it._purpose === f.purpose);
            if (!anyPurpose) return false;
          }

          // area: —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –æ–±—ä–µ–∫—Ç –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –¥–∏–∞–ø–∞–∑–æ–Ω
          const minA = f.minArea != null ? Number(f.minArea) : null;
          const maxA = f.maxArea != null ? Number(f.maxArea) : null;
          if (minA != null || maxA != null) {
            const ok = items.some(it => {
              const a = Number(it.area || 0);
              if (minA != null && a < minA) return false;
              if (maxA != null && a > maxA) return false;
              return true;
            });
            if (!ok) return false;
          }

          return true;
        }

        function applyFiltersAndFit() {
          if (!map) return;

          const VISIBLE_MAX_ZOOM = 16;
          const SINGLE_POINT_ZOOM = 14;

          let visiblePoints = [];

          groups.forEach(group => {
            const visible = matchesFilters(group);
            group.placemark.options.set('visible', visible);
            if (visible) visiblePoints.push(group.coords);
          });

          if (visiblePoints.length === 0) {
            map.setCenter([59.93, 30.33], 11);
            return;
          }

          if (visiblePoints.length === 1) {
            map.setCenter(visiblePoints[0], SINGLE_POINT_ZOOM);
            return;
          }

          // –ù–µ—Å–∫–æ–ª—å–∫–æ —Ç–æ—á–µ–∫ ‚Äî –≤–ø–∏—Å—ã–≤–∞–µ–º –≤ —ç–∫—Ä–∞–Ω
          const bounds = ymaps.util.bounds.fromPoints(visiblePoints);
          map.setBounds(bounds, { checkZoomRange: true, zoomMargin: 30 }).then(() => {
            // –û–≥—Ä–∞–Ω–∏—á–∏–º —Å–ª–∏—à–∫–æ–º —Å–∏–ª—å–Ω–æ–µ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–µ
            if (map.getZoom() > VISIBLE_MAX_ZOOM) {
              map.setZoom(VISIBLE_MAX_ZOOM);
            }
          });
        }

        // layout —Å–æ–∑–¥–∞—ë–º –æ–¥–∏–Ω —Ä–∞–∑
        const MINI_PIN_LAYOUT = ymaps.templateLayoutFactory.createClass(
          '<div style="position:absolute;transform:translate(-50%,-100%);' +
          'font-size:18px;line-height:1;user-select:none;">üìç</div>'
        );

        function buildMiniCollectionPlaceOnly() {
          const col = new ymaps.GeoObjectCollection();

          const activePlace = (window.filters?.place || '').trim();
          const filterByPlace = activePlace.length > 0;

          groups.forEach(g => {
            const placeName = (g.items?.[0]?.place || '').trim();
            if (filterByPlace && placeName !== activePlace) return;

            const coords = Array.isArray(g.coords) && g.coords.length === 2
              ? [Number(g.coords[0]), Number(g.coords[1])]
              : null;
            if (!coords) return;

            const pm = new ymaps.Placemark(
              coords,
              { placeName, hintContent: placeName ? `üìç ${placeName}` : undefined },
              {
                iconLayout: MINI_PIN_LAYOUT,
                iconShape: { type: 'Circle', coordinates: [0, -14], radius: 9 },
                zIndex: 500,
                zIndexHover: 600
              }
            );

            col.add(pm);
          });

          return col;
        }





        // function fitPoints(map, points, maxZoom) {
        //   if (!points.length) return;
        //   if (points.length === 1) { map.setCenter(points[0], Math.min(maxZoom, 13)); return; }
        //   const b = ymaps.util.bounds.fromPoints(points);
        //   map.setBounds(b, { checkZoomRange: true, zoomMargin: 20 }).then(() => {
        //     if (map.getZoom() > maxZoom) map.setZoom(maxZoom);
        //   });
        // }

        // function pointsFromCollection(col) {
        //   const pts = [];
        //   col.each(obj => pts.push(obj.geometry.getCoordinates()));
        //   return pts;
        // }



        // === –ú–ò–ù–ò-–ö–ê–†–¢–´ ===========================================================
        let thumbMap = null;      // –º–∞–ª–µ–Ω—å–∫–∞—è –∫–∞—Ä—Ç–∞ –≤ —Å—Ç—Ä–æ–∫–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        let previewMap = null;    // –±–æ–ª—å—à–∞—è –ø—Ä–µ–≤—å—é-–∫–∞—Ä—Ç–∞ –≤ –ø–æ–ø–æ–≤–µ—Ä–µ

        // function buildMiniCollectionFiltered() {
        //   const col = new ymaps.GeoObjectCollection();
        //   groups.forEach(g => {
        //     if (matchesFilters(g)) {
        //       col.add(new ymaps.Placemark(
        //         g.coords,
        //         {},
        //         { preset: 'islands#blueDotIcon' }   // –∫–æ–º–ø–∞–∫—Ç–Ω–∞—è —Ç–æ—á–∫–∞
        //       ));
        //     }
        //   });
        //   return col;
        // }

        function fitPoints(map, points, maxZoom) {
          if (!points.length) return;
          if (points.length === 1) {
            map.setCenter(points[0], Math.min(maxZoom, 12));
            return;
          }
          const b = ymaps.util.bounds.fromPoints(points);
          map.setBounds(b, { checkZoomRange: true, zoomMargin: 20 }).then(() => {
            if (map.getZoom() > maxZoom) map.setZoom(maxZoom);
          });
        }

        function pointsFromCollection(col) {
          const pts = [];
          col.each(obj => pts.push(obj.geometry.getCoordinates()));
          return pts;
        }

        function refreshMiniMaps() {
          // —Å—Ç—Ä–æ–∏–º —Ç–æ—á–∫–∏ –¢–û–õ–¨–ö–û –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ø–ª–æ—â–∞–¥–∫–∏
          const build = () => buildMiniCollectionPlaceOnly();

          if (thumbMap) {
            thumbMap.geoObjects.removeAll();
            const col = build();
            thumbMap.geoObjects.add(col);
            fitPoints(thumbMap, pointsFromCollection(col), 13);
            thumbMap.container.fitToViewport();
          }

          if (previewMap) {
            previewMap.geoObjects.removeAll();
            const col = build();
            previewMap.geoObjects.add(col);
            fitPoints(previewMap, pointsFromCollection(col), 14);
            previewMap.container.fitToViewport();
          }
        }

        function initThumbMap() {
          const holder = document.getElementById('mapThumbCanvas');
          if (!holder || thumbMap) return;

          thumbMap = new ymaps.Map(holder, {
            center: [59.93, 30.33], zoom: 11, controls: []
          }, { suppressMapOpenBlock: true });

          // –æ—Ç–∫–ª—é—á–∞–µ–º –≤—Å–µ –∂–µ—Å—Ç—ã ‚Äî –ø—Ä–µ–≤—å—é ¬´–Ω–µ–º–æ–µ¬ª
          thumbMap.behaviors.disable(['drag', 'scrollZoom', 'dblClickZoom', 'multiTouch', 'rightMouseButtonMagnifier']);

          refreshMiniMaps(); // <- —Ç–æ—á–∫–∏ —Å—Ä–∞–∑—É –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º

          new ResizeObserver(() => thumbMap?.container.fitToViewport()).observe(holder);
        }

        function initPreviewMap() {
          const holder = document.getElementById('mapThumbPreview');
          if (!holder || previewMap) return;

          previewMap = new ymaps.Map(holder, {
            center: [59.93, 30.33], zoom: 11, controls: []
          }, { suppressMapOpenBlock: true });

          previewMap.behaviors.disable(['drag', 'scrollZoom', 'dblClickZoom', 'multiTouch', 'rightMouseButtonMagnifier']);

          refreshMiniMaps();

          new ResizeObserver(() => previewMap?.container.fitToViewport()).observe(holder);
        }

        // –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–∞–ª–µ–Ω—å–∫—É—é –∫–∞—Ä—Ç—É —Å—Ä–∞–∑—É
        initThumbMap();

        // —Å–æ–∑–¥–∞—ë–º –±–æ–ª—å—à—É—é –ø—Ä–∏ –ø–µ—Ä–≤–æ–º —Ö–æ–≤–µ—Ä–µ
        const thumbBtn = document.getElementById('mapThumbBtn');
        thumbBtn?.addEventListener('mouseenter', () => {
          if (!previewMap) initPreviewMap();
          refreshMiniMaps();
          setTimeout(() => previewMap?.container.fitToViewport(), 0);
        });

        // –∫–ª–∏–∫ –ø–æ –º–∏–Ω–∏-–∫–∞—Ä—Ç–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ç–≤–æ—ë –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        thumbBtn?.addEventListener('click', () => {
          document.getElementById('openMapBtn')?.click();
        });

        // –ö–û–ì–î–ê –ú–ï–ù–Ø–Æ–¢–°–Ø –§–ò–õ–¨–¢–†–´ ‚Äî –æ–±–Ω–æ–≤–ª—è–µ–º –∏ –º–∏–Ω–∏-–∫–∞—Ä—Ç—ã
        window.addEventListener('filters:changed', () => {
          refreshMiniMaps();      // —Ç–æ—á–∫–∏ –∏ —Ä–∞–º–∫–∞ –ø–æ–¥ —Ñ–∏–ª—å—Ç—Ä—ã
        });




        function openModal() {
          modal.classList.remove('hidden');
          document.body.style.overflow = 'hidden';

          ensureMap();

          // –≤–∞–∂–Ω–æ –¥–ª—è YMaps, –∫–æ–≥–¥–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±—ã–ª —Å–∫—Ä—ã—Ç
          map.container.fitToViewport();

          // –ø—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã
          applyFiltersAndFit();
        }

        function closeModal() {
          modal.classList.add('hidden');
          document.body.style.overflow = '';
        }

        // –ö–Ω–æ–ø–∫–∏/–æ–≤–µ—Ä–ª–µ–π/Esc
        openBtn?.addEventListener('click', openModal);
        closeBtn?.addEventListener('click', closeModal);
        overlay?.addEventListener('click', closeModal);
        document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });

        // window.dispatchEvent(new CustomEvent('filters:changed'))
        window.addEventListener('filters:changed', () => {
          if (!map) return;
          applyFiltersAndFit();
        });
      });
    </script>



  </section>


  <footer class="bg-gray-900 text-gray-300 pt-16 pb-8">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-12">

        <div>
          <div class="flex items-center mb-4">

            <div class="ml-2 text-xl font-semibold text-white"> (–õ–æ–≥–æ) –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏</div>
          </div>
          <p class="mb-4">
            –í–µ–¥—É—â–∞—è –∫–æ–º–ø–∞–Ω–∏—è –ø–æ –∞—Ä–µ–Ω–¥–µ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –≤ –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥–µ
          </p>
          <div class="flex space-x-4">
            <!-- <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-instagram"></i></a> -->
            <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-telegram"></i></a>
            <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-vk"></i></a>
          </div>
        </div>


        <div>
          <h3 class="text-white text-lg font-semibold mb-4">–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</h3>
          <ul class="space-y-2">


            <li><a href="#" class="hover:text-white">–û—Ñ–∏—Å—ã</a></li>
            <li><a href="#" class="hover:text-white">–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</a></li>

          </ul>
        </div>


        <div>
          <h3 class="text-white text-lg font-semibold mb-4">–£—Å–ª—É–≥–∏</h3>
          <ul class="space-y-2">

            <li><a href="#" class="hover:text-white">–ê—Ä–µ–Ω–¥–∞ –æ—Ñ–∏—Å–æ–≤</a></li>
            <li><a href="#" class="hover:text-white">–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —É—Å–ª—É–≥–∏</a></li>
            <li><a href="#" class="hover:text-white">–û—Ü–µ–Ω–∫–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</a></li>
            <li><a href="#" class="hover:text-white">–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏</a></li>
          </ul>
        </div>


        <div>
          <h3 class="text-white text-lg font-semibold mb-4">–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
          <ul class="space-y-2">
            <li class="flex items-start">
              <i class="fas fa-phone-alt mt-1 mr-2"></i>
              <div>
                <a href="tel:+71231232827" class="hover:text-white">+7 (123) 123‚Äì28‚Äì27</a>
                <p class="text-sm text-gray-400">–ï–∂–µ–¥–Ω–µ–≤–Ω–æ —Å 9:00 –¥–æ 18:00</p>
              </div>
            </li>
            <li class="flex items-center">
              <i class="fas fa-envelope mr-2"></i>
              <a href="mailto:info@–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏.ru" class="hover:text-white">info@–ù–∞–∑–≤–∞–Ω–∏–µ
                –∫–æ–º–ø–∞–Ω–∏–∏.ru</a>
            </li>
            <li class="flex items-center">
              <i class="fas fa-map-marker-alt mr-2"></i>
              <span>–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥, –ù–µ–≤—Å–∫–∏–π –ø—Ä. 100</span>
            </li>
          </ul>
        </div>
      </div>

      <div class="border-t border-gray-800 pt-8 flex flex-col md:flex-row justify-between items-center">
        <div class="mb-4 md:mb-0">
          ¬© 2024 –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
        </div>
        <div class="flex space-x-4">
          <a href="#" class="hover:text-white">–£—Å–ª–æ–≤–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a>
          <a href="#" class="hover:text-white">–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>
          <a href="#" class="hover:text-white">–ö–∞—Ä—Ç–∞ —Å–∞–π—Ç–∞</a>
        </div>
      </div>
    </div>
  </footer>


  <div id="modal" class="modal fixed inset-0 z-50 flex items-center justify-center hidden">
    <div class="modal-overlay absolute inset-0"></div>
    <div class="modal-container bg-white w-full max-w-md mx-auto rounded-lg shadow-lg z-50 overflow-y-auto">
      <div class="modal-content py-4 px-6">
        <div class="flex justify-between items-center pb-3">
          <h3 class="text-xl font-bold">–û—Å—Ç–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É</h3>
          <button id="closeModalBtn" class="text-gray-500 hover:text-gray-700">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <form id="contactForm" class="space-y-4">
          <div>
            <label for="name" class="block text-gray-700 mb-1">–ò–º—è <span class="text-red-500">*</span></label>
            <input type="text" id="name"
              class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
          </div>

          <div>
            <label for="phone" class="block text-gray-700 mb-1">–¢–µ–ª–µ—Ñ–æ–Ω <span class="text-red-500">*</span></label>
            <input type="tel" id="phone"
              class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
          </div>

          <div>
            <label for="email" class="block text-gray-700 mb-1">Email</label>
            <input type="email" id="email"
              class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
          </div>

          <div>
            <label for="property-type" class="block text-gray-700 mb-1">–¢–∏–ø –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏</label>
            <select id="property-type"
              class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
              <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
              <option value="apartment">–ö–≤–∞—Ä—Ç–∏—Ä–∞</option>
              <option value="house">–î–æ–º</option>
              <option value="office">–û—Ñ–∏—Å</option>
              <option value="commercial">–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è</option>
            </select>
          </div>

          <div>
            <label for="message" class="block text-gray-700 mb-1">–°–æ–æ–±—â–µ–Ω–∏–µ</label>
            <textarea id="message" rows="3"
              class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
          </div>

          <div class="text-sm text-gray-500">
            <span class="text-red-500">*</span> –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è. –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 30 –º–∏–Ω—É—Ç.
          </div>

          <button type="submit"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-medium transition">
            –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É
          </button>
        </form>
      </div>
    </div>
  </div>

  <div id="mapModal" class="fixed inset-0 z-50 hidden">
    <div class="modal-overlay absolute inset-0 bg-black/50"></div>
    <div class="modal-container bg-white w-[95vw] max-w-5xl max-h-[90vh]
              mx-auto my-6 rounded-lg shadow-lg z-50 overflow-hidden
              flex flex-col">
      <div class="flex items-center justify-between px-5 py-3 border-b">
        <h3 class="text-lg font-semibold">–ù–∞—à–∏ –æ–±—ä–µ–∫—Ç—ã –Ω–∞ –∫–∞—Ä—Ç–µ</h3>
        <button id="closeMapBtn" class="text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="p-4">
        <div id="modalMap" class="w-full h-[70vh] rounded-lg"></div>
      </div>
    </div>
  </div>

  <script>
    function geojsonToPlString(geo) {
      try { if (typeof geo === 'string') geo = JSON.parse(geo); } catch (e) { }
      if (!geo) return '';
      if (geo.type === 'Feature') geo = geo.geometry;
      if (geo.type === 'FeatureCollection') geo = geo.features?.[0]?.geometry;
      const toStr = (coords) => (coords || []).map(([lon, lat]) => `${lon},${lat}`).join(',');
      if (geo?.type === 'Polygon') return toStr(geo.coordinates?.[0] || []);
      if (geo?.type === 'MultiPolygon') return toStr(geo.coordinates?.[0]?.[0] || []);
      return '';
    }

    function staticMapUrl({ lon, lat, plString, z = 14, w = 300, h = 200 }) {
      w = Math.min(Math.max(Math.round(w), 100), 650);
      h = Math.min(Math.max(Math.round(h), 100), 450);

      if (plString) {
        const style = 'c:4F46E5FF,w:3,f:4F46E544';
        const plParam = encodeURIComponent(`${style},${plString}`);
        return `https://static-maps.yandex.ru/1.x/?l=map&z=${z}&size=${w},${h}&pl=${plParam}`;
      }
      if (lon != null && lat != null) {
        return `https://static-maps.yandex.ru/1.x/?ll=${lon},${lat}&z=${z}&size=${w},${h}&l=map&pt=${lon},${lat},pm2rdm`;
      }
      return `https://static-maps.yandex.ru/1.x/?ll=30.33,59.93&z=${z}&size=${w},${h}&l=map`;
    }

    function parseSuitable(val) {
      if (!val) return [];
      if (Array.isArray(val)) return val.filter(Boolean);
      if (typeof val === 'string') {
        try {
          const parsed = JSON.parse(val);
          if (Array.isArray(parsed)) return parsed.filter(Boolean);
        } catch { }

        return val.split(',').map(s => s.trim()).filter(Boolean);
      }
      return [];
    }

function buildListUrlFromRow(row) {
  const place = (row.place || '').trim();
  const url = new URL(BASE + '/pages/list.html', location.origin);
  if (place) url.searchParams.set('place', place);
  const f = window.filters || {};
  if (f.minArea != null) url.searchParams.set('minArea', f.minArea);
  if (f.maxArea != null) url.searchParams.set('maxArea', f.maxArea);
  return url.toString();
}



    async function initCards() {
const cards = Array.from(document.querySelectorAll('.place-card[data-id]'));
  if (!cards.length) return;

  const ids = [...new Set(cards.map(c => Number(c.dataset.id)).filter(Boolean))];
  if (!ids.length) return;

  const { data, error } = await supabase
    .from('objects_min')
    .select('id,name,place,lat,lon,polygon,suitable_for')
    .in('id', ids);

  if (error) { console.error('Supabase error:', error); return; }

  const byId = new Map((data || []).map(r => [Number(r.id), r]));

  cards.forEach(card => {
    const id  = Number(card.dataset.id);
    const row = byId.get(id);
    if (!row) return;

    const img  = card.querySelector('.map-img');
    const skel = card.querySelector('.map-skeleton');
    const box = card.querySelector('.map-box') || card.querySelector('.relative') || card;
    if (!img || !box) return;

    const rect = box.getBoundingClientRect();
    const w = Math.min(Math.max(Math.round(rect.width  || 300), 100), 650);
    const h = Math.min(Math.max(Math.round(rect.height || 200), 100), 450);

    const pl  = geojsonToPlString(row.polygon);
    const url = staticMapUrl({ lon: row.lon, lat: row.lat, plString: pl, z: 14, w, h });

    img.onload  = () => { img.classList.add('loaded'); skel?.classList.add('hidden'); };
    img.onerror = () => { img.classList.add('loaded'); skel?.classList.add('hidden'); img.src = 'https://placehold.co/400x300?text=Map'; };
    img.alt = row.name || '–ö–∞—Ä—Ç–∞';
    img.src = url;
const base = { lon: row.lon, lat: row.lat, plString: pl, z: 14, w, h };

// ---------- HI-RES OVERLAY –° –ü–õ–ê–í–ù–´–ú –ö–†–û–°–°–§–ï–ô–î–û–ú (–æ—á–∏—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è) ----------
function hiResUrl() {
  const MAX_Z = 19;
  const Z_DELTA = 2; 
  const z2 = Math.min((base.z || 14) + Z_DELTA, MAX_Z);
  return staticMapUrl({ ...base, z: z2, w: 650, h: 450 });
}

let preloadPromise = null;
let overlay = null; 
let hoverTimer = null;
let isHovering = false;

function preload(src) {
  return new Promise((resolve, reject) => {
    const t = new Image();
    t.decoding = 'async';
    t.onload = () => resolve(t);
    t.onerror = reject;
    t.referrerPolicy = 'no-referrer';
    t.src = src;
  });
}

function showHiRes() {
  if (preloadPromise) return;
  preloadPromise = preload(hiResUrl())
    .then((hi) => {
      if (!isHovering) return;
      const box = card.querySelector('.map-box') || card;
      overlay = document.createElement('img');
      overlay.className = 'map-img absolute inset-0 w-full h-full object-cover';
      overlay.style.opacity = '0';
      overlay.style.pointerEvents = 'none';
      overlay.alt = img.alt || '–ö–∞—Ä—Ç–∞';
      overlay.referrerPolicy = 'no-referrer';
      overlay.src = hi.src;
      box.appendChild(overlay);

      // –ø–ª–∞–≤–Ω—ã–π –∫—Ä–æ—Å—Å—Ñ–µ–π–¥
      requestAnimationFrame(() => {
        overlay.style.transition = 'opacity .35s ease-out';
        overlay.style.opacity = '1';
      });
    })
    .catch(() => {})
    .finally(() => { preloadPromise = null; });
}

function hideHiRes() {
  if (!overlay) return;
  overlay.style.opacity = '0';
  overlay.addEventListener('transitionend', () => {
    overlay && overlay.remove();
    overlay = null;
  }, { once: true });
}

// —á—É—Ç–∫–∞ –∑–∞–¥–µ—Ä–∂–∏–º, —á—Ç–æ–±—ã –Ω–µ –¥—ë—Ä–≥–∞–ª–æ—Å—å –ø—Ä–∏ –ø—Ä–æ–ª—ë—Ç–µ –º—ã—à–∏
card.addEventListener('mouseenter', () => {
  isHovering = true; 
  hoverTimer = setTimeout(showHiRes, 60);
});
card.addEventListener('mouseleave', () => {
  isHovering = false;
  clearTimeout(hoverTimer);
  hideHiRes();
});




    const titleEl = card.querySelector('h3');
    if (titleEl) titleEl.innerHTML = (row.place || row.name || '‚Äî').replace(/ /g, '<br>');

    const subtitleEl = card.querySelector('.text-sm.text-gray-600');
    if (subtitleEl) {
      const tags = parseSuitable(row.suitable_for);
      subtitleEl.textContent = tags.length ? tags.slice(0,3).join(' ‚Ä¢ ') : '‚Äî';
    }

    const href = buildListUrlFromRow(row);
    let a = card.querySelector('a.stretched-link');
    if (!a) {
      a = document.createElement('a');
      a.className = 'stretched-link absolute inset-0';
      a.setAttribute('aria-label', row.name || row.place || '–û—Ç–∫—Ä—ã—Ç—å');
      card.appendChild(a);
    }
    a.href = href;

    card.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        window.location.href = href;
      }
    });
  });
    }

    document.addEventListener("DOMContentLoaded", () => {
      initCards();
    });

  </script>




</body>

</html>
